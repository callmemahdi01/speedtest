<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سرعت سنج با GPS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="light.css" id="theme-stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <h1 class="app-title">سرعت سنج خودرو</h1>
            <p class="app-subtitle">با استفاده از فناوری GPS</p>
            
            <!-- Dark Mode Toggle Switch -->
            <div class="theme-toggle-container">
                <label class="theme-toggle" for="darkModeToggle">
                    <input type="checkbox" id="darkModeToggle">
                    <div class="slider round">
                        <i class="fas fa-sun light-icon"></i>
                        <i class="fas fa-moon dark-icon"></i>
                    </div>
                </label>
            </div>
        </div>
        
        <div class="speedometer">
            <div class="speed-circle">
                <div>
                    <div class="speed-value" id="speed">0</div>
                    <div class="speed-unit">کیلومتر بر ساعت</div>
                </div>
            </div>
            
            <div class="max-speed">
                <span class="max-speed-label">حداکثر سرعت:</span>
                <span class="max-speed-value"><span id="maxSpeed">0</span> کیلومتر بر ساعت</span>
            </div>
        </div>
        
        <div class="status-panel">
            <i class="fas fa-info-circle"></i>
            <span class="status-text" id="status">در انتظار شروع...</span>
        </div>
        
        <div class="controls">
            <button id="startButton" class="btn start-btn">
                <i class="fas fa-play"></i>
                شروع اندازه گیری
            </button>
            <button id="resetButton" class="btn reset-btn">
                <i class="fas fa-redo-alt"></i>
                بازنشانی
            </button>
        </div>
    </div>

    <script>
        const speedElement = document.getElementById('speed');
        const statusElement = document.getElementById('status');
        const maxSpeedElement = document.getElementById('maxSpeed');
        const startButton = document.getElementById('startButton');
        const resetButton = document.getElementById('resetButton');
        const statusPanel = document.querySelector('.status-panel');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const themeStylesheet = document.getElementById('theme-stylesheet');
        
        let watchId = null;
        let maxSpeed = 0;
        
        // Check for saved theme preference
        if (localStorage.getItem('darkMode') === 'enabled') {
            enableDarkMode();
            darkModeToggle.checked = true;
        }
        
        // Dark mode toggle event listener
        darkModeToggle.addEventListener('change', function() {
            if (this.checked) {
                enableDarkMode();
            } else {
                disableDarkMode();
            }
        });
        
        // Functions to handle dark mode
        function enableDarkMode() {
            themeStylesheet.setAttribute('href', 'dark.css');
            localStorage.setItem('darkMode', 'enabled');
        }
        
        function disableDarkMode() {
            themeStylesheet.setAttribute('href', 'light.css');
            localStorage.setItem('darkMode', 'disabled');
        }
        
        startButton.addEventListener('click', startMeasuring);
        resetButton.addEventListener('click', resetMeasurements);
        
        function startMeasuring() {
            if (!navigator.geolocation) {
                statusElement.textContent = 'مرورگر شما از GPS پشتیبانی نمی کند';
                statusPanel.classList.add('error');
                return;
            }
            
            statusElement.textContent = 'در حال اتصال به GPS...';
            startButton.disabled = true;
            
            const options = {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
            };
            
            watchId = navigator.geolocation.watchPosition(
                updateSpeed,
                handleError,
                options
            );
        }
        
        function updateSpeed(position) {
            if (position.coords.speed === null) {
                statusElement.textContent = 'سرعت قابل اندازه گیری نیست. لطفاً در حال حرکت باشید.';
                return;
            }
            
            // Convert m/s to km/h
            const speedKmh = (position.coords.speed * 3.6).toFixed(1);
            
            // Update current speed
            speedElement.textContent = speedKmh;
            
            // Update max speed if current speed is higher
            if (parseFloat(speedKmh) > maxSpeed) {
                maxSpeed = parseFloat(speedKmh);
                maxSpeedElement.textContent = maxSpeed.toFixed(1);
            }
            
            statusElement.textContent = 'در حال اندازه گیری...';
            statusPanel.classList.remove('error');
        }
        
        function handleError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    statusElement.textContent = 'دسترسی به موقعیت مکانی رد شد';
                    break;
                case error.POSITION_UNAVAILABLE:
                    statusElement.textContent = 'اطلاعات موقعیت مکانی در دسترس نیست';
                    break;
                case error.TIMEOUT:
                    statusElement.textContent = 'درخواست موقعیت مکانی منقضی شد';
                    break;
                default:
                    statusElement.textContent = 'خطای ناشناخته رخ داد';
                    break;
            }
            
            statusPanel.classList.add('error');
            startButton.disabled = false;
        }
        
        function resetMeasurements() {
            if (watchId !== null) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
            
            speedElement.textContent = '0';
            maxSpeed = 0;
            maxSpeedElement.textContent = '0';
            statusElement.textContent = 'در انتظار شروع...';
            statusPanel.classList.remove('error');
            startButton.disabled = false;
        }
    </script>
</body>
</html>